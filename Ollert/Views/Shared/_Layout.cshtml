@using Microsoft.AspNet.Identity
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title - Ollert</title>
    @Styles.Render("~/Content/bootstrap")
    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")

</head>
<body>
    <div class="navbar navbar-default" id="navbar">    
        <div class="navbar-container" id="navbar-container">
            <div class="navbar-header pull-left">
                <a href="#" class="navbar-brand">
                    <small>
                        <i class="icon-align-right"></i>
                        Ollert
                    </small>
                </a><!-- /.brand -->
            </div><!-- /.navbar-header -->

            <div class="navbar-header pull-right" role="navigation">
                <ul class="nav ace-nav">
                    <li class="grey">
                        <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                            <i class="icon-group"></i>
                            <span class="badge badge-grey" data-bind="text: connectedUsers().length"></span>
                        </a>

                        <ul class="pull-right dropdown-navbar dropdown-menu dropdown-caret dropdown-close">
                            <li class="dropdown-header">
                                <i class="icon-ok"></i>
                                <span data-bind="text: connectedUsers().length"></span> Utilisateurs connectés
                            </li>

                            <!-- ko foreach: connectedUsers -->
                            <li>
                                <a href="#">
                                    <img class="msg-photo" alt="Avatar" data-bind="attr: { src: avatarPath() }" />
                                    <span class="msg-body user-notification">
                                        <span class="msg-title">
                                            <span class="blue" data-bind="text: name"></span>
                                        </span>
                                    </span>
                                </a>
                            </li>
                            <!-- /ko -->

                        </ul>
                    </li>

                    <li class="purple">
                        <a data-toggle="dropdown" class="dropdown-toggle" href="#" data-bind="click: declareNotifAsSeen">
                            <i class="icon-bell-alt" id="notif-icon" data-bind="css: { 'icon-animated-bell': totalNewNotifications() > 0 }"></i>
                            <span class="badge badge-important" data-bind="text: totalNewNotifications(), valueUpdate: 'afterkeydown'"></span>
                        </a>

                        <ul class="pull-right dropdown-navbar navbar-pink dropdown-menu dropdown-caret dropdown-close">
                            <li class="dropdown-header">
                                <i class="icon-warning-sign"></i>
                                <span data-bind="text: totalNewNotifications, valueUpdate: 'afterkeydown'"></span> Notifications
                            </li>

                            <!-- ko foreach: lastNotifications() -->
                            <li data-bind="css: {notification: isNotifViewed()}">
                                <a href="#">
                                    <img class="msg-photo" alt="Action" data-bind="attr: {src: notificationImgUrl()}" />
                                    <span class="msg-body">
                                        <span class="msg-title">
                                            <span data-bind="text: text"></span>
                                        </span>

                                        <span class="msg-time pink2">
                                            <i class="icon-time"></i>
                                            <span data-bind="text: formattedDate"></span>
                                        </span>
                                    </span>
                                </a>
                            </li>
                            <!-- /ko -->
                            @*<li>
                                &nbsp;
                            </li>*@
                        </ul>
                    </li>

                    <li class="green">
                        <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                            <i class="icon-comment" id="comment-icon" data-bind="css: { 'icon-animated-vertical': newMessagesNumber() > 0 }"></i>
                            <span class="badge badge-success" data-bind="text: newMessagesNumber">0</span>
                        </a>

                        <ul class="pull-right dropdown-navbar dropdown-menu dropdown-caret dropdown-close">
                            <li class="dropdown-header">
                                <i class="icon-envelope-alt"></i>
                                <span data-bind="text: newMessagesNumber"></span> Messages
                            </li>
                            <!-- ko foreach: lastMessages() -->
                            <li data-bind="css: {notification: isViewed()}">
                                <a href="#">
                                    <img class="msg-photo" alt="Avatar" data-bind="attr: {src: user().avatarPath()}" />
                                    <span class="msg-body">
                                        <span class="msg-title">
                                            <span class="blue" data-bind="text: user().name"></span>
                                            <span data-bind="text: text"></span>
                                        </span>

                                        <span class="msg-time">
                                            <i class="icon-time"></i>
                                            <span data-bind="text: formattedDate">a moment ago</span>
                                        </span>
                                    </span>
                                </a>
                            </li>
                            <!-- /ko -->
                            @*<li>
                                &nbsp;
                            </li>*@
                        </ul>
                    </li>

                    <li class="light-blue">
                        <a data-toggle="dropdown" href="#" class="dropdown-toggle">
                            <img class="nav-user-photo" src="/Board/AvatarImage/@User.Identity.GetUserId()" alt="User Photo" />
                            <span class="user-info">
                                <small>Bienvenue,</small>
                                @User.Identity.GetUserName()
                            </span>

                            <i class="icon-caret-down"></i>
                        </a>

                        <ul class="user-menu pull-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">
                            <li>
                                <a href="#">
                                    <i class="icon-cog"></i>
                                    Parametres
                                </a>
                            </li>

                            <li>
                                <a href="#">
                                    <i class="icon-user"></i>
                                    Profil
                                </a>
                            </li>

                            <li class="divider"></li>

                            <li>
                                <div style="display:none">
                                    @using (Html.BeginForm("LogOff", "Account", FormMethod.Post, new { id = "logoutForm", @class = "navbar-right" }))
                                    {
                                        @Html.AntiForgeryToken()
                                    }
                                </div>
                                <a href="javascript:document.getElementById('logoutForm').submit()">
                                    <i class="icon-off"></i>
                                    Déconnexion
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul><!-- /.ace-nav -->
            </div><!-- /.navbar-header -->
        </div><!-- /.container -->
    </div>


    <div class="body-content">
        @RenderBody()
    </div>

    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")
    @Scripts.Render("~/bundles/libraries")
    <script type="text/javascript">
        (function () {
            if (typeof Object.defineProperty === 'function') {
                try { Object.defineProperty(Array.prototype, 'sortBy', { value: sb }); } catch (e) { }
            }
            if (!Array.prototype.sortBy) Array.prototype.sortBy = sb;

            function sb(f) {
                for (var i = this.length; i;) {
                    var o = this[--i];
                    this[i] = [].concat(f.call(o, o, i), o);
                }
                this.sort(function (a, b) {
                    for (var i = 0, len = a.length; i < len; ++i) {
                        if (a[i] != b[i]) return a[i] > b[i] ? -1 : 1;
                    }
                    return 0;
                });
                for (var i = this.length; i;) {
                    this[--i] = this[i][this[i].length - 1];
                }
                return this;
            }
        })();
    </script>
    @RenderSection("scripts", required: false)
</body>
</html>
